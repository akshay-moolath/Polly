<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Register — Chatty</title>

  <style>
    :root{
      --radius:16px;
      --accent: #2563eb;
      --accent-2: #06b6d4;
      --muted: rgba(15,23,42,0.6);
      --glass-1: rgba(255,255,255,0.65);
      --glass-2: rgba(255,255,255,0.50);
      --danger: #ef4444;
      --ok: #059669;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color-scheme: light;
    }

    html,body{height:100%;margin:0;background:
      radial-gradient(900px 500px at 10% 10%, rgba(102,126,234,0.07), transparent 8%),
      radial-gradient(700px 400px at 90% 80%, rgba(3,218,198,0.05), transparent 8%),
      linear-gradient(180deg,#f8fafc,#eef2ff);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;align-items:center;justify-content:center;padding:28px;
    }

    .card{
      width:100%;
      max-width:520px;
      border-radius:var(--radius);
      padding:28px;
      background: linear-gradient(180deg, var(--glass-1), var(--glass-2));
      border: 1px solid rgba(255,255,255,0.6);
      box-shadow: 0 12px 40px rgba(11,20,40,0.07);
      backdrop-filter: blur(10px) saturate(120%);
      -webkit-backdrop-filter: blur(10px) saturate(120%);
      position:relative;
      overflow:hidden;
    }

    .card::before{
      content:'';
      position:absolute;
      inset:-40% -40% auto -40%;
      height:200px;
      background: linear-gradient(90deg, rgba(96,165,250,0.06), rgba(16,185,129,0.04));
      transform: rotate(6deg);
      pointer-events:none;
    }

    h1{ margin:0 0 6px; font-size:26px; color: #0b3aa6; }
    p.lead{ margin:0 0 18px; color:var(--muted); font-size:14px; }

    .grid{ display:grid; gap:12px; margin-top:12px; }

    label{ display:block; font-size:13px; color:var(--muted); margin-bottom:6px; }
    input{
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid rgba(15,23,42,0.06);
      background: linear-gradient(180deg, rgba(255,255,255,0.75), rgba(250,250,250,0.7));
      font-size:15px;
      color: #08203a;
      outline:none;
      transition: box-shadow .12s ease, transform .06s ease, border-color .12s ease;
    }
    input::placeholder{ color: rgba(11,20,40,0.35); }

    input:focus{
      border-color: rgba(37,99,235,0.85);
      box-shadow: 0 10px 30px rgba(37,99,235,0.06);
      transform: translateY(-1px);
      background: rgba(255,255,255,0.95);
    }

    .primary{
      width:100%;
      padding:12px 16px;
      border-radius:12px;
      border:0;
      color:#fff;
      font-weight:700;
      cursor:pointer;
      background: linear-gradient(90deg,var(--accent),var(--accent-2));
      box-shadow: 0 10px 30px rgba(51,102,255,0.14);
      margin-top:6px;
    }
    .primary:hover{ transform: translateY(-2px); box-shadow: 0 14px 40px rgba(51,102,255,0.2); }

    .footer{ margin-top:14px; text-align:center; color:var(--muted); font-size:14px; }
    .footer a{ color:var(--accent); text-decoration:none; font-weight:600; }
    .footer a:hover{ text-decoration:underline; }

    #msg{
      margin-top:14px;
      padding:10px;
      border-radius:8px;
      font-weight:600;
      display:none;
      font-size:14px;
    }
    #msg.error{ display:block; background: rgba(254,226,226,0.95); color: #b91c1c; border:1px solid rgba(254,202,202,0.9); }
    #msg.success{ display:block; background: rgba(220,253,235,0.95); color: #047857; border:1px solid rgba(167,243,208,0.9); }
    #msg.status{ display:block; background: rgba(245,247,250,0.95); color:var(--muted); border:1px solid rgba(226,232,240,0.9); }

    @media (max-width:520px){
      .card{ padding:20px; border-radius:12px; }
      h1{ font-size:22px; }
    }
  </style>
</head>
<body>
  <div class="card" role="main" aria-labelledby="reg-title">
    <h1 id="reg-title">Create your account</h1>
    <p class="lead">Join Chatty to chat with your friends.</p>

    <form id="register-form" aria-describedby="msg" novalidate>
      <div class="grid">
        <div>
          <label for="username">Username</label>
          <input id="username" name="username" placeholder="Choose a username" required />
        </div>

        <div>
          <label for="email">Email</label>
          <input id="email" name="email" type="email" placeholder="you@example.com" required />
        </div>

        <div>
          <label for="password">Password</label>
          <input id="password" name="password" type="password" placeholder="Create a password" required />
        </div>

        <button class="primary" type="submit">Create Account</button>
      </div>

      <div class="footer">
        Already have an account?
        <a href="/" aria-label="Go to login">Login</a>
      </div>

      <div id="msg" role="status" aria-live="polite"></div>
    </form>
  </div>

<script>
/* Preserves your original registration behaviour exactly:
   - posts to /api/users
   - same input names: username, email, password
   - shows feedback messages in #msg
   No backend changes required.
*/
const form = document.getElementById("register-form");
const msg = document.getElementById("msg");

function setMsg(type, text){
  msg.className = '';
  msg.textContent = text;
  if (type === 'error') {
    msg.classList.add('error');
  } else if (type === 'success') {
    msg.classList.add('success');
  } else {
    msg.classList.add('status');
  }
  msg.style.display = 'block';
}

function clearMsg(){
  msg.style.display = 'none';
  msg.className = '';
  msg.textContent = '';
}

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  clearMsg();
  setMsg('status','Registering...');

  const payload = {
    username: form.username.value.trim(),
    email: form.email.value.trim(),
    password: form.password.value
  };

  try {
    const res = await fetch("/api/users", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });

    const body = await (async ()=>{ try { return await res.json(); } catch { return null; } })();

    if (res.ok) {
      setMsg('success','Registration successful! Redirecting…');
      setTimeout(()=> { location.href = '/'; }, 700);
      return;
    }

    setMsg('error', body?.detail || 'Registration failed. Please try again.');
  } catch (err) {
    console.error(err);
    setMsg('error','Network error. Try again.');
  }
});
</script>
</body>
</html>
